
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Xcode UI Testing and Location Permission Alerts - Daniel Beard</title>
  <meta name="author" content="Daniel Beard">

  
  <meta name="description" content="With Xcode 7, Apple has given us a new tool for user interface testing.
I&rsquo;m not going to cover the basics here, but for an great introduction &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://danielbeard.io/blog/2015/07/17/xcode-ui-testing-and-location-permission-alerts">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Daniel Beard" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=Open+Sans:400,700&subset=latin" rel="stylesheet" type="text/css" />
<link href='http://fonts.googleapis.com/css?family=Noto+Serif:400,700' rel='stylesheet' type='text/css'>



  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-40809716-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <nav id="main-nav" role="navigation">
<ul class="main-navigation">
  <li><a href="/" class="nav-link">Blog</a></li>
  <li><a href="/blog/archives" class="nav-link">Archives</a></li>
	<li><a href="https://github.com/daniel-beard">GitHub</a></li>
	<li><a href="https://twitter.com/_danielbeard">Twitter</a></li>
	<li><a href="/about">About</a></li>
</ul>

</nav>
  
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Xcode UI Testing and Location Permission Alerts</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-17T19:08:28-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>With Xcode 7, Apple has given us a new tool for user interface testing.
I&rsquo;m not going to cover the basics here, but for an great introduction to user interface testing in Xcode, check out this awesome article: <a href="http://masilotti.com/ui-testing-xcode-7/">UI Testing in Xcode 7</a></p>

<p>As of beta 3, there is no way to handle native system alerts. This is a pretty big roadblock to actually UI testing apps that support location. Luckily, we can work around this by digging a little bit into the CoreLocation framework.</p>

<p>A prerequisite for this is the <a href="http://www.hopperapp.com">Hopper Disassembler</a>, which I can&rsquo;t recommend highly enough. It&rsquo;s a great starting point for poking at and tearing apart system frameworks, libraries and executables.</p>

<p>First, lets open the CoreLocation framework with Hopper. As of writing, this framework existed on the file system at:</p>

<pre><code>/Applications/Xcode-beta.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk/System/Library/Frameworks/CoreLocation.framework
</code></pre>

<p>Let&rsquo;s open the binary within the framework.</p>

<p><img src="http://danielbeard.io/images/corelocationhopper.png" alt="CoreLocationHopper" /></p>

<p>Looking on the left panel under &ldquo;labels&rdquo;, there are lots of <code>CLLocationManager</code> methods. Scrolling through, we can see a couple of interesting authorization related ones.</p>

<pre><code>+[CLLocationManager _authorizationStatus]
+[CLLocationManager authorizationStatus]
+[CLLocationManager setAuthorizationStatus:forBundleIdentifier:]
+[CLLocationManager setAuthorizationStatus:forBundle:]
</code></pre>

<p>The <code>setAuthorizationStatus:forBundle:</code> method is a private method, but since we are going to be only calling it from a test, we can use it.
Note: Do NOT use this in a production app, you will absolutely be rejected from the app store.
This is going to let us set the location permission to whatever we want, while supressing the location alert from showing.</p>

<p>While we can&rsquo;t call the method directly, we can build a method signature and invoke a custom invocation like this:</p>

<div><script src='https://gist.github.com/8238e12afd926a234813.js'></script>
<noscript><pre><code>    SEL selector = NSSelectorFromString(@&quot;setAuthorizationStatus:forBundleIdentifier:&quot;);
    NSMethodSignature *methodSignature = [CLLocationManager methodSignatureForSelector:selector];
    NSInvocation *invocation = [NSInvocation invocationWithMethodSignature:methodSignature];
    invocation.selector = selector;
    
    CLAuthorizationStatus status = kCLAuthorizationStatusAuthorizedAlways;
    NSString *identifier = @&quot;com.test.testapp&quot;;
    
    [invocation setArgument:&amp;status atIndex:2];
    [invocation setArgument:&amp;identifier atIndex:3];
    [invocation invokeWithTarget:[CLLocationManager class]];</code></pre></noscript></div>


<ul>
<li>Notice that the invocation argument indexes start at 2, this is because the first two arguments are implicit (<code>self</code> and <code>_cmd</code>)</li>
<li>We used a bundle identifier string rather than loading the bundle, this is because as UI tests run they run inside a different TestRunner bundle.</li>
</ul>


<p>That&rsquo;s it! Enjoy!</p>

<blockquote><p>Beta 4 is coming soon, hopefully ï£¿ fixes all the pain points and remaining concerns of UI testing :)</p></blockquote>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Daniel Beard</span></span>

      








  


<time datetime="2015-07-17T19:08:28-07:00" pubdate data-updated="true"></time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://danielbeard.io/blog/2015/07/17/xcode-ui-testing-and-location-permission-alerts/" data-via="_danielbeard" data-counturl="http://danielbeard.io/blog/2015/07/17/xcode-ui-testing-and-location-permission-alerts/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/05/06/setting-up-travis-ci-for-automated-unit-testing-of-ios-projects-on-github/" title="Previous Post: Setting up travis-ci for automated unit testing of iOS projects on GitHub">&laquo; Setting up travis-ci for automated unit testing of iOS projects on GitHub</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Daniel Beard -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
