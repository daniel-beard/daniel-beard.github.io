
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Terrain Generation - Diamond Square Algorithm - Daniel Beard</title>
  <meta name="author" content="Daniel Beard">

  
  <meta name="description" content="I have posted previously about a simple terrain heightmap display program I have made, but never talked about some of the methods of generating and &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://danielbeard.io/blog/2010/08/06/terrain-generation-and-smoothing">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Daniel Beard" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=Open+Sans:400,700&subset=latin" rel="stylesheet" type="text/css" />
<link href='http://fonts.googleapis.com/css?family=Noto+Serif:400,700' rel='stylesheet' type='text/css'>



  

</head>

<body    class="collapse-sidebar sidebar-footer" >
  <nav id="main-nav" role="navigation">
<ul class="main-navigation">
  <li><a href="/" class="nav-link">Blog</a></li>
  <li><a href="/blog/archives" class="nav-link">Archives</a></li>
	<li><a href="https://github.com/daniel-beard">GitHub</a></li>
	<li><a href="/about">About</a></li>
</ul>

</nav>
  
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Terrain Generation - Diamond Square Algorithm</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-06T18:21:18-07:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I have posted previously about a simple terrain heightmap display program I have made, but never talked about some of the methods of generating and manipulating heightmap based terrain systems.</p>

<p>The method I have implemented in my terrain generation program is known as the Diamond-Square algorithm and is a method of procedural terrain generation. The Diamond-Square algorithm is also known as random midpoint displacement fractal, cloud fractal or the plasma fractal.</p>

<p>We start with a 2D array of size (n<sup>2</sup> + 1) E.g. 257, 513 etc. Set the four corners to initial values, these can be random or preset it doesn&rsquo;t really matter too much at this point.</p>

<p>We then perform the diamond step which consists of taking the four points arranged in a square shape, averaging the four values and adding a random value to the average, creating diamond shapes. The square step then averages the four corners of the diamonds created in the previous step. The center value of this step becomes the corners of the next step. The diamond and square step are repeated until all the points in the grid have values assigned to them.</p>

<p><a href="http://danielbeard.files.wordpress.com/2010/08/diamond-square-algorithm.png"><img src="http://danielbeard.files.wordpress.com/2010/08/diamond-square-algorithm.png" alt="" /></a>The image above shows the alternating steps being carried out. The red dots are the pixels with new values, the black dots are pixels with existing values. The pseudocode from gameprogrammer.com is as follows:</p>

<pre><code> While the length of the side of the squares
 is greater than zero {
 Pass through the array and perform the diamond
 step for each square present.
 Pass through the array and perform the square
 step for each diamond present.
 Reduce the random number range.
 } (GameProgrammer.com)
</code></pre>

<p>Then we end up with a program that can generate terrain / cloud maps / general fractal noise. Below is an example image that I have generated at 512x512.</p>

<p><a href="http://danielbeard.files.wordpress.com/2010/08/terrain.png"><img src="http://danielbeard.files.wordpress.com/2010/08/terrain.png?w=300" alt="Heightmap 512x512" /></a></p>

<p>Below is a sample of what the terrain looks like with simple shading in OpenGL without textures. The shading effect is calculated by giving a colour based on the minimum and maximum values of the heightmap. E.g. VertexColour = (value - minY) / (maxY - minY);</p>

<p><a href="http://danielbeard.files.wordpress.com/2010/08/terrain-simple.png"><img src="http://danielbeard.files.wordpress.com/2010/08/terrain-simple.png?w=300" alt="" /></a></p>

<p>I find that the easiest way to import data from my terrain generation program into the display program is to use the built-in IO functions to create an easy to read file format. The advantage of using this method is that you can store heights as floating point values instead of bytes (0-255) this gives many more possible heights, a greater dynamic range. The code to write these files is quite simple:</p>

<pre><code>&lt;span style="color:#0000ff;"&gt;void&lt;/span&gt; SaveTerrFile(){
        &lt;span style="color:#999999;"&gt;//Write to file&lt;/span&gt;
        FILE *fp;
        fp = fopen(&lt;span style="color:#339966;"&gt;"terrain.terr"&lt;/span&gt;, &lt;span style="color:#339966;"&gt;"wb"&lt;/span&gt;);

        &lt;span style="color:#999999;"&gt;//print out the data&lt;/span&gt;
        &lt;span style="color:#3366ff;"&gt;for&lt;/span&gt;(&lt;span style="color:#ff9900;"&gt;int&lt;/span&gt; x=0; x &lt; DATA_SIZE-&lt;span style="color:#ff9900;"&gt;1&lt;/span&gt;; x++){
            &lt;span style="color:#3366ff;"&gt;for&lt;/span&gt;(&lt;span style="color:#ff9900;"&gt;int&lt;/span&gt; y=0; y &lt; DATA_SIZE-&lt;span style="color:#ff9900;"&gt;1&lt;/span&gt;; y++){
                  &lt;span style="color:#999999;"&gt;//populate the point struct&lt;/span&gt;
                  point.x = x;
                  point.y = data[x][y];
                  point.z = y;
                  &lt;span style="color:#999999;"&gt;//smooth out the range a bit&lt;/span&gt;
                  point.y = (point.y-minY)/(maxY-minY);
                  point.y *= &lt;span style="color:#ff9900;"&gt;255&lt;/span&gt;;
                  &lt;span style="color:#999999;"&gt;//write to file&lt;/span&gt;
                  fwrite(&amp;point, &lt;span style="color:#3366ff;"&gt;sizeof&lt;/span&gt;(point), &lt;span style="color:#ff9900;"&gt;1&lt;/span&gt;, fp);
           }
        }
        &lt;span style="color:#999999;"&gt;//close file pointer&lt;/span&gt;
        fclose(fp);
}
</code></pre>

<p>Other features that I think need to be added to this code is the ability to generate textures as well based on the height values, smoothing of the terrain and improvements to the viewer. For now though, here is some source code. This code saves the height values to a file. I haven&rsquo;t included any image saving functionality in this version because I am not sure of the licensing issues that may arise. Will find out soon, more updates to this coming in the next couple of days.</p>

<p>Link: <a href="http://www.divshare.com/download/12203776-cbc">Download Source Code </a></p>

<p>Other Useful Links / Articles:</p>

<p><a href="http://www.gameprogrammer.com/fractal.html#diamond">http://www.gameprogrammer.com/fractal.html#diamond
</a><a href="http://stackoverflow.com/questions/2755750/diamond-square-algorithm">http://stackoverflow.com/questions/2755750/diamond-square-algorithm
</a><a href="http://en.wikipedia.org/wiki/Diamond-square_algorithm">http://en.wikipedia.org/wiki/Diamond-square_algorithm</a></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">danielbeard</span></span>

      








  


<time datetime="2010-08-06T18:21:18-07:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/games-development/'>games development</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://danielbeard.io/blog/2010/08/06/terrain-generation-and-smoothing/" data-via="_danielbeard" data-counturl="http://danielbeard.io/blog/2010/08/06/terrain-generation-and-smoothing/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2010/08/03/anti-aliased-raytracing/" title="Previous Post: Anti-Aliased Raytracing">&laquo; Anti-Aliased Raytracing</a>
      
      
        <a class="basic-alignment right" href="/blog/2010/08/07/smoothing-terrain/" title="Next Post: Smoothing Terrain">Smoothing Terrain &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Daniel Beard -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
